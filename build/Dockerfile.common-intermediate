FROM eu.gcr.io/pryvio/base:1.3.40
MAINTAINER "Tech@Pryv" <tech@pryv.com>

# Set main paths that will be reused in this docker file
ARG TARGET_DIR="/app/bin"

# copy all code to the target dir except files mentioned in .dockerignore
COPY . $TARGET_DIR
WORKDIR $TARGET_DIR

RUN yarn setup

# Perform a release build of the source code. (-> dist)
RUN yarn release > /dev/null

# Remove copy as we only need transpiled code from dist/
RUN rm -rf components && rm -rf node_modules
