FROM pryvio/common-intermediate:latest

# pass building name as an argument (like core,previews or other)
ARG COMPONENT_NAME
ENV COMPONENT_NAME=$COMPONENT_NAME

ARG TARGET_DIR="/app/bin"

# Install the script that runs the service
RUN mkdir -p /etc/runit/ && mkdir -p /etc/service/runit/
RUN cp -r $TARGET_DIR/build/$COMPONENT_NAME/runit/* /etc/runit/
RUN mv /etc/runit/runit.sh /etc/init.d/

# Make a link to /etc/service (will be run with runit).
RUN ln -s /etc/init.d/runit.sh /etc/service/runit/run
